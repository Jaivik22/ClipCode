import{g as v,s as T,d as B,a as L}from"./firebase-bundle.js";document.addEventListener("DOMContentLoaded",async()=>{const x=document.getElementById("sendBtn"),h=document.getElementById("receiveBtn"),I=document.getElementById("backBtnSend"),k=document.getElementById("backBtnReceive"),c=document.getElementById("noteText"),r=document.getElementById("generateCodeBtn"),l=document.getElementById("generatedCode"),u=document.getElementById("syncCode"),i=document.getElementById("getNoteBtn"),o=document.getElementById("receivedNote"),m=document.getElementById("sendSection"),g=document.getElementById("receiveSection"),p=document.getElementById("buttonContainer"),s=document.getElementById("charCounter"),b=r.querySelector(".loader"),E=i.querySelector(".loader");c.addEventListener("input",()=>{const t=c.value.length;s.textContent=`${t}/500`,s.style.color=t>450?"#dc2626":"#6b7280"});const S=async()=>{const t=v();let e,n=!0,d=0;const y=10;for(;n&&d<y;)e=Math.floor(1e5+Math.random()*9e5).toString(),n=(await L(B(t,"notes",e))).exists(),console.log("exists",n),d++;if(n)throw new Error("Unable to generate a unique code. Please try again.");return e},C=()=>{m.style.display="none",g.style.display="none",p.style.display="flex",c.value="",u.value="",l.textContent="",o.textContent="",s.textContent="0/500",s.style.color="#6b7280"};x.addEventListener("click",()=>{m.style.display="block",g.style.display="none",p.style.display="none"}),h.addEventListener("click",()=>{m.style.display="none",g.style.display="block",p.style.display="none"}),I.addEventListener("click",C),k.addEventListener("click",C),r.addEventListener("click",async()=>{const t=c.value.trim();if(!t){l.innerHTML='<span class="error">Please write a note to share.</span>';return}r.disabled=!0,b.classList.remove("hidden");try{const e=v(),n=await S();await T(B(e,"notes",n),{text:t,createdAt:new Date().toISOString()}),l.innerHTML=`<span class="success">Success! Your sync code: <strong>${n}</strong></span>`,c.value="",s.textContent="0/500",s.style.color="#6b7280"}catch(e){console.log(e.message),l.innerHTML=`<span class="error">Failed to save note: ${e.message}</span>`}finally{r.disabled=!1,b.classList.add("hidden")}}),i.addEventListener("click",async()=>{const t=u.value.trim();if(!/^\d{6}$/.test(t)){o.innerHTML='<span class="error">Please enter a valid 6-digit code.</span>';return}i.disabled=!0,E.classList.remove("hidden");try{const e=v(),n=B(e,"notes",t),d=await L(n);if(d.exists()){const y=d.data().text;o.innerHTML=`
                    <span class="success">Note: ${y}</span>
                    <button id="copyBtn">Copy Note</button>
                `,u.value="";const a=document.getElementById("copyBtn");a.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(y),a.textContent="Copied!",a.style.backgroundColor="#16a34a",setTimeout(()=>{a.textContent="Copy Note",a.style.backgroundColor="#16a34a"},2e3)}catch(f){o.innerHTML+=`<br><span class="error">Failed to copy: ${f.message}</span>`}})}else o.innerHTML='<span class="error">No note found for this code.</span>'}catch(e){o.innerHTML=`<span class="error">Failed to retrieve note: ${e.message}</span>`}finally{i.disabled=!1,E.classList.add("hidden")}})});
